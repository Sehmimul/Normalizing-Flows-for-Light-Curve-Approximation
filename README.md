# Final_Project - Group 5
# PHYS449 Supernovae Classification by Light Curve Approximation

### Collaborators:
- name: Vishnu Mugundan
- student ID: 20823106

- name: Maimouna Sow
- student ID: 20822614

- name: Sehmimul Hoque
- student ID: 20814946

- name: Siddhardha Penmetsa
- student ID: 20924945

## Install Dependencies

- numpy
- matplotlib
- torch
- fulu
- pandas
- sklearn
- joblib
- torchvision

Code to install requirements:
```sh
pip3 install -r requirements.txt
```

## Running `main.py`

To run `main.py`, use

```sh
python3 main.py
```

Get more information about the other arguments by running

```sh
python3 main.py --help
```

An example call of the program is

```sh
python main.py --param param/param.json -nf 10 -v -p
```

1. `-nf num_objects` runs Normalizing Flows to approximate `num_objects` light curves, and runs the CNN on the objects. In the above example, the code will produce 10 objects using Normalizing Flows, and run CNN on the 10 objects. `num_objects` must be at least 10. Be warned that even with multiprocessing implemented, the code takes a while to run.
2. `-v` increases the verbosity of the program.
3. `-p`produces plots for the light curves of the objects generated by Normalizing Flows.
4. `-s` shuffles the objects generated by Normalizing Flows. 

## Running suggestions and Remarks

It is suggested that you train the CNN using the data of 600 objects already obtained by us and then run NF for 15-50 objects depending on the computing resources. NF training takes some time, and can be tracked in the most verbose mode. (Note that we are training and sampling from the NF in paralell) The sampling process will take a very long time. For getting predicted flux for 20 objects, the NF process is expected to take around 20-30 minutes depending on the computational resources, even though we run NF for multiple objects in parallel. It is also recommended that the code is ran in the most verbose mode at all times as then you can know which stage we are at.

## Hyperparameters in `param/param.json`

### NF
- num_samples: number of samples taken from the Multivariate Gaussian prior for inverse transforms
- lr: Learning rate of the Adam Optimizer
- n_epochs: Number of epochs for updating the parameters of the unknown model
- display_epochs: Number of epochs for printing the loss

### CNN
- n_epochs: Number of epochs for updating the parameters of the unknown model
- display_epochs: Number of epochs for printing the loss
- weight_decay: regularization technique applied to the weights of CNN
- lr: Learning rate of the gradient descent

## File Structure
- `main.py` : main running script
- `nfmetrics.csv` : contains metrics of flux approximation using normalizing flows
- `report.txt` : final report containing metrics for normalizing flows, training epochs of the CNN and metrics of CNN
- `requirements.txt` : requirements
- `src/normalizing_flows.py` : normalizing flows module
- `src/CNN.py` : CNN module
- `src/plot_utls.py` : plot utilities for normalizing flows
-  `src/cnn_metrics.py` : cnn metrics utilities
- `src/nf_metrics.py` : normalizing flows metrics utilities
- `src/X_matrix.json` : outputed flux and flux error for one full run of normalizing flows
- `src/y_vector.json` : supernovae binary prediction of objects in `src/X_matrix.json`
- `data/ANTARES_NEW.csv` : dataset containing relevant data for flux interpolation and flux type classification of 1870 objects
- `data/images.json` : flux and flux error for 600 objects using the normalzing flows algorithm (CNN can be trained on this data)
- `data/labels.json` : supernovae binary prediction of the 600 objects in `images.json`
- `param/param,json` : hyperparameters
- `plots`: contains plots of several flux interpolations using normalizing flows

## Plots

The plots directory contains several flux interpolations using normalizing flows. The x axis represents the timestamps and the y axis represents the flux. The 2 colours represent the 2 passbands. The dots represent the points (timestamp, passband, flux) obtained from the `data\ANTARES_NEW.csv` dataset. The solid lines represent the predicted flux obtained from normalizing flows.

